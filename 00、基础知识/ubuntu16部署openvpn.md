```
1、安装openvpn、easy-rsa
root@ubuntu:~# apt-get install openvpn easy-rsa
2、创建CA目录
root@ubuntu:~# make-cadir ~/openvpn-ca
3、配置CA变量
root@ubuntu:~/openvpn-ca# nano vars
export KEY_NAME="server"   //修改key_name  其余可不操作
4、制作CA
root@ubuntu:~/openvpn-ca# cd ~/openvpn-ca
root@ubuntu:~/openvpn-ca# source vars
NOTE: If you run ./clean-all, I will be doing a rm -rf on /home/sammy/openvpn-ca/keys
输出此句，说明成功
root@ubuntu:~/openvpn-ca# ./clean-all
root@ubuntu:~/openvpn-ca# ./build-ca    //一路回车
5、制作Server端的 Server Certificate, Key, Encryption Files
root@ubuntu:~/openvpn-ca# ./build-key-server server    //一路回车，遇到y输y
root@ubuntu:~/openvpn-ca# ./build-dh
6、制作Client端的 Client Certificate, Key
root@ubuntu:~/openvpn-ca# cd ~/openvpn-ca
root@ubuntu:~/openvpn-ca# source vars
root@ubuntu:~/openvpn-ca# ./build-key client1
7、配置OpenVPN服务器
root@ubuntu:~/openvpn-ca# cd ~/openvpn-ca/keys
root@ubuntu:~/openvpn-ca/keys# sudo cp ca.crt server.crt server.key ta.key dh2048.pem /etc/openvpn
root@ubuntu:~/openvpn-ca/keys# gunzip -c /usr/share/doc/openvpn/examples/sample-config-files/server.conf.gz | sudo tee /etc/openvpn/server.conf
8、修改OpenVPN配置文件
root@ubuntu:~/openvpn-ca/keys# sudo nano /etc/openvpn/server.conf
tls-auth ta.key 0 # This file is secret   //去掉注释
key-direction 0       //添加
cipher AES-128-CBC    //去掉注释
auth SHA256          //添加
user nobody           //去掉注释
group nogroup        //去掉注释
9、调整网络配置
root@ubuntu:~/openvpn-ca/keys# sudo nano /etc/sysctl.conf
net.ipv4.ip_forward=1    //去掉注释
root@ubuntu:~/openvpn-ca/keys# sudo sysctl -p
10、调整防火墙规则
root@ubuntu:~/openvpn-ca/keys# ip route | grep default
default via 192.168.91.2 dev ens38  proto static  metric 100   //注意我的网卡是ens38,没个人网卡不一样
root@ubuntu:~/openvpn-ca/keys# sudo nano /etc/ufw/before.rules
//在#  ufw-before-forward下一段，添加如下，注意ens38的使用
# START OPENVPN RULES
# NAT table rules
*nat
:POSTROUTING ACCEPT [0:0] 
# Allow traffic from OpenVPN client to ens38 (change to the interface you discovered!)
-A POSTROUTING -s 10.8.0.0/8 -o ens38 -j MASQUERADE
COMMIT
# END OPENVPN RULES
11、默认允许转发包：
root@ubuntu:~/openvpn-ca/keys# sudo nano /etc/default/ufw
DEFAULT_FORWARD_POLICY="ACCEPT"   //修改drop为accept
12、打开openvpn端口，使变化生效
root@ubuntu:~/openvpn-ca/keys# sudo ufw allow 1194/udp
root@ubuntu:~/openvpn-ca/keys# sudo ufw allow OpenSSH
root@ubuntu:~/openvpn-ca/keys# sudo ufw disable
root@ubuntu:~/openvpn-ca/keys# sudo ufw enable
13、开启openvpn服务
root@ubuntu:~/openvpn-ca/keys# sudo systemctl start openvpn@server
root@ubuntu:~/openvpn-ca/keys# sudo systemctl status openvpn@server
root@ubuntu:~/openvpn-ca/keys# ip addr show tun0
14、创建客户端配置目录
root@ubuntu:~/openvpn-ca/keys# mkdir -p ~/client-configs/files
root@ubuntu:~/openvpn-ca/keys# chmod 700 ~/client-configs/files
15、创建基本的配置文件
root@ubuntu:~/openvpn-ca/keys# cp /usr/share/doc/openvpn/examples/sample-config-files/client.conf ~/client-configs/base.conf
remote 192.168.11.139 1194       // server_IP_address 改为具体的openvpn服务器ip地址
proto udp                       //确保使用udp协议
user nobody                     //去掉注释
group nogroup                   //去掉注释
#ca ca.crt                      //添加注释
#cert client.crt                //添加注释
#key client.key                 //添加注释
cipher AES-128-CBC              //与服务器端配置保持一致
auth SHA256
key-direction 1
16、写一个自动生成客户端.ovpn配置文件的脚本
root@ubuntu:~/openvpn-ca/keys# nano ~/client-configs/make_config.sh
\\将如下内容复制到make_config.sh中
#!/bin/bash

# First argument: Client identifier

KEY_DIR=~/openvpn-ca/keys
OUTPUT_DIR=~/client-configs/files
BASE_CONFIG=~/client-configs/base.conf

cat ${BASE_CONFIG} \
    <(echo -e '<ca>') \
    ${KEY_DIR}/ca.crt \
    <(echo -e '</ca>\n<cert>') \
    ${KEY_DIR}/${1}.crt \
    <(echo -e '</cert>\n<key>') \
    ${KEY_DIR}/${1}.key \
    <(echo -e '</key>\n<tls-auth>') \
    ${KEY_DIR}/ta.key \
    <(echo -e '</tls-auth>') \
    > ${OUTPUT_DIR}/${1}.ovpn
17、修改权限
root@ubuntu:~/openvpn-ca/keys# chmod 700 ~/client-configs/make_config.sh
18、生成客户端.ovpn配置文件
root@ubuntu:~/openvpn-ca/keys# cd ~/client-configs
root@ubuntu:~/client-configs# ./make_config.sh client1

客户端安装完毕后，将client1.ovpn复制到本地openvpn安装目录C:\Program Files\OpenVPN\config下。 


















































```

